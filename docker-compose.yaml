version: '3'
services:
  nginx:
    build:
      context: ./docker
      dockerfile: nginx.docker
    volumes:
      - ./application:/app
    depends_on:
      - app-php-fpm
    ports:
      - "8080:80"
  app-php-fpm:
    build:
      context: ./docker
      dockerfile: php-fpm.docker
    volumes:
      - ./application:/app
    depends_on:
      - rabbitmq
  app-php-cli:
    build:
      context: ./docker
      dockerfile: php-cli.docker
    volumes:
      - ./application:/app
      - composer:/root/.composer/cache
    depends_on:
      - rabbitmq
  rabbitmq:
    image: rabbitmq:3.8-management-alpine
    ports:
      - 127.0.0.1:15672:15672
      - 127.0.0.1:5672:5672
    volumes:
      - rabbitmq-data:/var/lib/rabbitmq

volumes:
  rabbitmq-data:
  composer: